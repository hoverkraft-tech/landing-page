---
import { getLangFromUrl, useTranslatedPath } from '~/i18n/utils';

const { className } = Astro.props as { className?: string };
const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);
const fallbackUrl = translatePath('/maturity-assessment');
---

<section class={className ?? 'pt-8 pb-4'}>
  <div class="max-w-3xl mx-auto px-4 sm:px-6">
    <div class="rounded-2xl border border-gray-200/60 bg-white p-6">
      <div
        class="hs-form-frame"
        data-region="eu1"
        data-form-id="b3290f73-2d7a-4052-8637-5158d38713e8"
        data-portal-id="147601161"
        data-maturity-field="maturity_assessment"
      >
      </div>
    </div>
  </div>
</section>

<script is:inline src="https://js-eu1.hsforms.net/forms/embed/147601161.js" defer></script>
<script is:inline define:vars={{ fallbackUrl }}>
  const hasMaturityAssessmentParam = () => {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const maturityAssessment = urlParams.get('maturity_assessment');
      if (maturityAssessment && maturityAssessment.length > 0) {
        return true;
      }
      return false;
    } catch {
      return false;
    }
  };

  if (!hasMaturityAssessmentParam()) {
    window.location.replace(fallbackUrl);
  }
</script>
