---
publishDate: 2025-08-21T00:00:00Z
title: 'Devcontainers et asdfÂ : hoverkraft rÃ©pare lâ€™intÃ©gration indispensable'
excerpt: 'Suite au breaking change dâ€™asdf v0.16.0, lâ€™Ã©quipe hoverkraft remet sur pied lâ€™intÃ©gration devcontainer pour Azure et partage son guide dâ€™adoption.'
image: ~/assets/images/blog/devcontainer-asdf-feature/preview.png
tags:
  - devcontainers
  - asdf
  - tooling
  - azure
  - iac
lang: fr
translationKey: devcontainers-asdf
---

import Image from '~/components/common/Image.astro';
import codeSnippet from '~/assets/images/blog/devcontainer-asdf-feature/code-snippet.png';

> ğŸš€ Bonne nouvelle pour celles et ceux qui utilisent Devcontainers avec asdfÂ !

Lorsque la version v0.16.0 dâ€™asdf est sortie, un breaking change a cassÃ© la feature Â«Â baseÂ Â» fournie par Microsoft dans les devcontainers. RÃ©sultatÂ : impossible dâ€™initialiser automatiquement vos runtimes prÃ©fÃ©rÃ©s lors de lâ€™ouverture dâ€™un projet. Lâ€™Ã©quipe hoverkraft a retroussÃ© ses manches pour reconstruire une intÃ©gration fiable et vous Ã©viter de bricoler chaque nouveau container.

## Pourquoi Ã§a bloquaitÂ ?

asdf est un gestionnaire de versions multi-langages trÃ¨s populaire dans les Ã©quipes cloud et IaC. La mise Ã  jour 0.16.0 a modifiÃ© la faÃ§on dont les plugins sont dÃ©tectÃ©s et initialisÃ©s. Les scripts gÃ©nÃ©riques embarquÃ©s dans lâ€™image `devcontainers/base` sâ€™attendaient Ã  lâ€™ancien comportement et ne provisionnaient plus les runtimes dÃ©clarÃ©s dans `.tool-versions`.

ConsÃ©quence directeÂ : un dÃ©veloppeur ouvrant un repo reposant sur asdf se retrouvait avec une image saineâ€¦ mais sans Node, Python, Terraform ou Azure CLI configurÃ©s. Dans un environnement dâ€™infrastructure-as-code, câ€™est synonyme de frictions, dâ€™erreurs CI/CD et dâ€™onboarding pÃ©nible.

## Ce que nous avons reconstruit

Pour rÃ©tablir lâ€™expÃ©rience Â«Â Ã§a marche dÃ¨s lâ€™ouverture du containerÂ Â», nous avons :

1. **RetirÃ© la dÃ©pendance** au script dÃ©prÃ©ciÃ© en recrÃ©ant une feature devcontainer spÃ©cifique Ã  asdf.
2. **AlignÃ© lâ€™installation** sur le nouveau comportement dâ€™asdf, en gÃ©nÃ©rant les hooks et chemins attendus par la v0.16.0 et suivantes.
3. **AutomatisÃ© lâ€™installation de plugins** courants (Terraform, Azure CLI, Node.jsâ€¦) dÃ¨s la phase `postCreateCommand` pour que le container soit opÃ©rationnel en moins dâ€™une minute.
4. **DocumentÃ© lâ€™usage** dans un dÃ©pÃ´t public afin que vous puissiez lâ€™intÃ©grer en copiant-collant trois fichiers.

ğŸ“¦ Le dÃ©pÃ´t est disponible iciÂ : [hoverkraft-tech/devcontainers](https://github.com/hoverkraft-tech/devcontainers)

## Guide express pour adopter la feature

### 1. Ajouter la feature devcontainer asdf

Dans votre `.devcontainer/devcontainer.json`, rÃ©fÃ©rencez lâ€™image hoverkraftÂ :

```json
{
  "name": "infra-azure",
  "image": "mcr.microsoft.com/devcontainers/base:bullseye",
  "features": {
    "ghcr.io/hoverkraft-tech/devcontainers/asdf:latest": {}
  }
}
```

### 2. Lister vos runtimes dans `.tool-versions`

Exemple utilisÃ© en production pour un projet IaC AzureÂ :

```
terraform 1.8.4
python 3.12.2
nodejs 20.11.1
azure-cli 2.61.0
```

Ã€ lâ€™ouverture du container, la feature installera automatiquement la version demandÃ©e de chaque outil, en tirant parti des plugins maintenus par la communautÃ©.

### 3. Tirer parti des hooks post-installation

Nous avons inclus un script `post-start.sh` quiÂ :

- met Ã  jour les plugins si une version plus rÃ©cente est disponibleÂ ;
- configure les variables dâ€™environnement (`ASDF_DATA_DIR`, `PATH`) pour que vos scripts `make`, `taskfile` ou `terraform` fonctionnent immÃ©diatementÂ ;
- expose des logs clairs dans la console VS Code pour diagnostiquer un Ã©ventuel plugin manquant.

Adaptez-le Ã  votre contexte (ajout dâ€™outils internes, vÃ©rifications de modules Terraform, etc.).

## Pour celles et ceux qui dÃ©couvrent les devcontainers

Les devcontainers encapsulent votre stack de dÃ©veloppement dans un container Docker reproductible. Chez hoverkraft, nous les utilisons pourÂ :

- **Garantir la portabilitÃ©** de lâ€™environnement Terraform/Azure dâ€™un projet Ã  lâ€™autre.
- **SÃ©curiser lâ€™onboarding**Â : un nouveauÂ·elle arrivantÂ·e obtient un environnement prÃªt en un clic.
- **Validations CI locales**Â : les mÃªmes outils et versions tournent en local et dans vos pipelines.

Si vous nâ€™en avez jamais crÃ©Ã©, voici notre trame minimalisteÂ :

```json
{
  "name": "iac-azure",
  "image": "mcr.microsoft.com/devcontainers/base:bullseye",
  "features": {
    "ghcr.io/devcontainers/features/azure-cli:1": {},
    "ghcr.io/hoverkraft-tech/devcontainers/asdf:latest": {}
  },
  "postCreateCommand": "./.devcontainer/scripts/post-start.sh"
}
```

Ajoutez ensuite vos configurations VS Code (`extensions.json`, `settings.json`) pour partager le mÃªme linting, les snippets Terraform, etc.

<figure>
  <Image
    src={codeSnippet}
    width={codeSnippet.width}
    height={codeSnippet.height}
    alt="Illustration de la configuration devcontainer.json avec la feature asdf maintenue par hoverkraft"
    loading="lazy"
  />
  <figcaption>Configuration devcontainer.json mise Ã  jour pour assurer la compatibilitÃ© avec asdf v0.16+</figcaption>
</figure>

## RÃ©sultatÂ : un workflow IaC fluide sur Azure

En combinant devcontainers, asdf et cette feature maison, nous avons :

- supprimÃ© les discrepancies entre macOS, Windows et LinuxÂ ;
- rÃ©duit le temps dâ€™onboarding de 45Â minutes Ã  moins de 5Â minutesÂ ;
- fiabilisÃ© nos pipelines, car les mÃªmes versions dâ€™outils tournent partout.

Et parce quâ€™on aime aller plus loin, nous rÃ©flÃ©chissons dÃ©jÃ  Ã  :

- ajouter des tests automatiques de compatibilitÃ© lorsquâ€™une nouvelle version dâ€™asdf sortÂ ;
- publier une image de base spÃ©cialisÃ©e Â«Â IaC AzureÂ Â» avec Terraform, Bicep, Packer et Azure Developer CLI dÃ©jÃ  prÃ©installÃ©s.

## Partagez vos retours

Nous espÃ©rons que cette brique vous fera gagner du temps. Clonez le dÃ©pÃ´t, branchez la feature dans vos projets et dites-nous si tout fonctionne dans vos contextes (mono-repo, projets data, plateformes internesâ€¦).

Ã€ trÃ¨s vite pour la suiteÂ !
