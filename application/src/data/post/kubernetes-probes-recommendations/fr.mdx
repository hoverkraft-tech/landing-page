---
title: 'Probes Kubernetes : recommandations Hoverkraft'
excerpt: 'Liveness, readiness, startup : la grille Hoverkraft pour √©viter les faux positifs, prot√©ger vos SLA Kubernetes et aligner les probes sur la cha√Æne de delivery.'
slug: recommandations-probes-kubernetes
author: '√âquipe HoverKraft'
lang: fr
translationKey: kubernetes-probes-recommendations
---

import Image from '~/components/common/Image.astro';
import preview from '~/assets/images/blog/kubernetes-probes-recommendations/preview.png';

> Une probe mal r√©gl√©e est un incident en attente.

Les probes Kubernetes sont la ligne officielle pour d√©cider si un Pod peut servir du trafic ou doit √™tre recycl√©. Mal calibr√©es, elles provoquent des boucles de red√©marrage, des d√©gradations silencieuses et des alertes bruyantes.

Nous croisons la documentation Kubernetes, le blog Google Cloud sur les health checks et le protocole gRPC Health Check avec nos missions plateformes. Voici notre approche opinionated, mesur√©e avec DORA/SPACE.

<Image src={preview} alt="Recommandations Hoverkraft pour les probes Kubernetes" loading="lazy" />

## Pourquoi bien d√©finir ses probes ?

Liveness, readiness et startup ne servent pas au m√™me moment : la premi√®re d√©tecte un process bloqu√©, la deuxi√®me prot√®ge vos utilisateurs, la troisi√®me absorbe la latence d'initialisation. Les confondre augmente le change failure rate et masque la vraie disponibilit√©.

- Limiter les faux positifs : ne jamais tuer un Pod qui sert encore.
- Garder un signal fiable pour l'autoscaling, les PDB et les d√©ploiements progressifs.
- Aligner la sant√© applicative sur vos SLO plut√¥t que sur des heuristiques r√©seau.

## Notre grille Hoverkraft

Nous traitons la plateforme comme une cha√Æne de delivery : chaque probe est un connecteur mesurable. Nous priorisons l'exp√©rience d√©veloppeur (DX) et la souverainet√© technique en proposant des presets test√©s sur nos clusters.

- Startup probe pour les phases de warmup (migrations, cache) afin de bloquer liveness.
- Readiness centr√©e sur la capacit√© √† servir, pas sur la sant√© des d√©pendances non critiques.
- Liveness minimaliste : v√©rifier le process, pas le monde ext√©rieur.
- Synth√®se de notre guide Hoverkraft : la startup absorbe le warmup, la readiness inclut uniquement les d√©pendances critiques, la liveness reste locale et l√©g√®re, et les seuils sont valid√©s via PDB/HPA + tests de charge (https://docs.hoverkraft.cloud/docs/methodology/best-practices/kubernetes-probes/).

## Startup probe : absorber le warmup

La startup probe √©vite qu'un service lourd soit tu√© avant d'√™tre pr√™t. Elle remplace temporairement la liveness pendant l'initialisation.

### DOs

- Mesurez le temps de warmup r√©el (logs, traces) et ajoutez une marge.
- Utilisez une commande ou un endpoint sp√©cifique qui valide que l'app est initialis√©e.
- Ajustez failureThreshold et periodSeconds pour couvrir les migrations longues.

### Don'ts

- Ne laissez pas la startup probe active ind√©finiment : elle doit c√©der la place √† la liveness.
- N'utilisez pas un check externe (base de donn√©es, API tierce) : l'objectif est l'initialisation locale.
- Ne copiez pas les timeouts de production sans tester en staging.

Exemple HTTP pour une appli qui charge un cache en 90 secondes et ne doit pas √™tre tu√©e pendant ce warmup :

```yaml
startupProbe:
  httpGet:
    path: /startup
    port: 8080
  failureThreshold: 18 # 18 * 5s = 90s
  periodSeconds: 5
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  periodSeconds: 10
  timeoutSeconds: 2
readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 2
```

## Readiness probe : prot√©ger les utilisateurs

La readiness probe d√©cide si le Pod peut recevoir du trafic sans d√©grader l'exp√©rience.

### DOs

- Testez la capacit√© √† r√©pondre : requ√™te HTTP l√©g√®re sur une route interne ou gRPC healthz.
- Incluez les d√©pendances indispensables (DB primaire, cache chaud) mais pas les services secondaires.
- Utilisez initialDelaySeconds pour laisser le Pod rejoindre le mesh ou enregistrer ses routes.

### Don'ts

- Ne m√©langez pas readiness et liveness : une d√©pendance lente ne doit pas red√©marrer le Pod.
- √âvitez les checks lourds (requ√™tes SQL complexes, appel √† des SaaS).
- Ne laissez pas un code 200 par d√©faut : retournez 503 tant que le Pod n'est pas pr√™t.

Exemple readiness qui v√©rifie un cache chaud mais reste l√©ger :

```yaml
readinessProbe:
  httpGet:
    path: /ready?cache=warm
    port: 8080
  failureThreshold: 3
  periodSeconds: 5
  timeoutSeconds: 2
```

## Liveness probe : d√©tecter les blocages

La liveness probe d√©tecte les deadlocks et fuites qui emp√™chent le process de se soigner seul.

### DOs

- Utilisez un check l√©ger (fichier PID, /healthz interne, gRPC health) sans d√©pendances externes.
- Choisissez un d√©lai plus tol√©rant que la readiness pour √©viter les red√©marrages pendant un pic.
- Tracez les √©checs de liveness (logs structur√©s) pour corr√©ler avec vos m√©triques DORA MTTR.

### Don'ts

- Ne pointez pas vers la base de donn√©es ou un service externe.
- N'utilisez pas la m√™me route que la readiness si elle d√©clenche des charges lourdes.
- N'ignorez pas les red√©marrages CrashLoopBackOff : ajustez seuils plut√¥t que de d√©sactiver la probe.

Exemple liveness minimaliste sans d√©pendance externe :

```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  failureThreshold: 3
  periodSeconds: 10
  timeoutSeconds: 1
```

## R√®gles transverses

Quelques r√®gles transverses pour des probes fiables :

- Pr√©f√©rez HTTP ou gRPC healthz aux exec scripts co√ªteux.
- Synchronisez les probes avec vos strat√©gies de d√©ploiement (maxUnavailable, PDB, HPA).
- Documentez et testez vos seuils via des tests de charge ou de chaos engineering.

## Sources

- Documentation Kubernetes sur les probes : https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
- Google Cloud - Kubernetes best practices pour readiness/liveness : https://cloud.google.com/blog/products/gcp/kubernetes-best-practices-setting-up-health-checks-with-readiness-and-liveness-probes
- gRPC Health Checking Protocol : https://github.com/grpc/grpc/blob/master/doc/health-checking.md
- Hoverkraft - bonnes pratiques probes : https://docs.hoverkraft.cloud/docs/methodology/best-practices/kubernetes-probes/

## Conclusion

Des probes bien d√©finies maintiennent la cha√Æne de delivery fluide et mesur√©e. Elles prot√®gent vos utilisateurs, vos √©quipes SRE et vos indicateurs DORA.

üëâ Discutons de vos probes et SLO : https://www.hoverkraft.tech/contact

üëâ Explorez nos connecteurs open source : https://github.com/hoverkraft-tech
