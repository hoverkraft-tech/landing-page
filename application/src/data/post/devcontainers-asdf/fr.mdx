---
title: "Devcontainers et asdf : hoverkraft r√©pare l'int√©gration indispensable"
excerpt: "Suite au breaking change d'asdf v0.16.0, l'√©quipe hoverkraft remet sur pied l'int√©gration devcontainer pour Azure et partage son guide d'adoption."
slug: devcontainer-asdf-feature
author: '√âquipe HoverKraft'
lang: fr
---

import Image from '~/components/common/Image.astro';
import codeSnippet from '~/assets/images/blog/devcontainer-asdf-feature/code-snippet.png';

> üöÄ Bonne nouvelle pour celles et ceux qui utilisent Devcontainers avec asdf !

Lorsque la version v0.16.0 d'asdf est sortie, un breaking change a cass√© la feature ¬´ base ¬ª fournie par Microsoft dans les devcontainers. R√©sultat : impossible d'initialiser automatiquement vos runtimes pr√©f√©r√©s lors de l'ouverture d'un projet. L'√©quipe hoverkraft a retrouss√© ses manches pour reconstruire une int√©gration fiable et vous √©viter de bricoler chaque nouveau container.

## Pourquoi √ßa bloquait ?

asdf est un gestionnaire de versions multi-langages tr√®s populaire dans les √©quipes cloud et IaC. La mise √† jour 0.16.0 a modifi√© la fa√ßon dont les plugins sont d√©tect√©s et initialis√©s. Les scripts g√©n√©riques embarqu√©s dans l'image `devcontainers/base` s'attendaient √† l'ancien comportement et ne provisionnaient plus les runtimes d√©clar√©s dans `.tool-versions`.

Cons√©quence directe : un d√©veloppeur ouvrant un repo reposant sur asdf se retrouvait avec une image saine‚Ä¶ mais sans Node, Python, Terraform ou Azure CLI configur√©s. Dans un environnement d'infrastructure-as-code, c'est synonyme de frictions, d'erreurs CI/CD et d'onboarding p√©nible.

## Ce que nous avons reconstruit

Pour r√©tablir l'exp√©rience ¬´ √ßa marche d√®s l'ouverture du container ¬ª, nous avons :

1. **Retir√© la d√©pendance** au script d√©pr√©ci√© en recr√©ant une feature devcontainer sp√©cifique √† asdf.
2. **Align√© l'installation** sur le nouveau comportement d'asdf, en g√©n√©rant les hooks et chemins attendus par la v0.16.0 et suivantes.
3. **Automatis√© l'installation de plugins** courants (Terraform, Azure CLI, Node.js‚Ä¶) d√®s la phase `postCreateCommand` pour que le container soit op√©rationnel en moins d'une minute.
4. **Document√© l'usage** dans un d√©p√¥t public afin que vous puissiez l'int√©grer en copiant-collant trois fichiers.

üì¶ Le d√©p√¥t est disponible ici : [hoverkraft-tech/devcontainers](https://github.com/hoverkraft-tech/devcontainers)

## Guide express pour adopter la feature

### 1. Ajouter la feature devcontainer asdf

Dans votre `.devcontainer/devcontainer.json`, r√©f√©rencez l'image hoverkraft :

```json
{
  "name": "infra-azure",
  "image": "mcr.microsoft.com/devcontainers/base:bullseye",
  "features": {
    "ghcr.io/hoverkraft-tech/devcontainers/asdf:latest": {}
  }
}
```

### 2. Lister vos runtimes dans `.tool-versions`

Exemple utilis√© en production pour un projet IaC Azure :

```
terraform 1.8.4
python 3.12.2
nodejs 20.11.1
azure-cli 2.61.0
```

√Ä l'ouverture du container, la feature installera automatiquement la version demand√©e de chaque outil, en tirant parti des plugins maintenus par la communaut√©.

### 3. Tirer parti des hooks post-installation

Nous avons inclus un script `post-start.sh` qui :

- met √† jour les plugins si une version plus r√©cente est disponible ;
- configure les variables d'environnement (`ASDF_DATA_DIR`, `PATH`) pour que vos scripts `make`, `taskfile` ou `terraform` fonctionnent imm√©diatement ;
- expose des logs clairs dans la console VS Code pour diagnostiquer un √©ventuel plugin manquant.

Adaptez-le √† votre contexte (ajout d'outils internes, v√©rifications de modules Terraform, etc.).

## Pour celles et ceux qui d√©couvrent les devcontainers

Les devcontainers encapsulent votre stack de d√©veloppement dans un container Docker reproductible. Chez hoverkraft, nous les utilisons pour :

- **Garantir la portabilit√©** de l'environnement Terraform/Azure d'un projet √† l'autre.
- **S√©curiser l'onboarding** : un nouveau¬∑elle arrivant¬∑e obtient un environnement pr√™t en un clic.
- **Validations CI locales** : les m√™mes outils et versions tournent en local et dans vos pipelines.

Si vous n'en avez jamais cr√©√©, voici notre trame minimaliste :

```json
{
  "name": "iac-azure",
  "image": "mcr.microsoft.com/devcontainers/base:bullseye",
  "features": {
    "ghcr.io/devcontainers/features/azure-cli:1": {},
    "ghcr.io/hoverkraft-tech/devcontainers/asdf:latest": {}
  },
  "postCreateCommand": "./.devcontainer/scripts/post-start.sh"
}
```

Ajoutez ensuite vos configurations VS Code (`extensions.json`, `settings.json`) pour partager le m√™me linting, les snippets Terraform, etc.

<figure>
  <Image
    src={codeSnippet}
    width={codeSnippet.width}
    height={codeSnippet.height}
    alt="Illustration de la configuration devcontainer.json avec la feature asdf maintenue par hoverkraft"
    loading="lazy"
  />
  <figcaption>Configuration devcontainer.json mise √† jour pour assurer la compatibilit√© avec asdf v0.16+</figcaption>
</figure>

## R√©sultat : un workflow IaC fluide sur Azure

En combinant devcontainers, asdf et cette feature maison, nous avons :

- supprim√© les discrepancies entre macOS, Windows et Linux ;
- r√©duit le temps d'onboarding de 45 minutes √† moins de 5 minutes ;
- fiabilis√© nos pipelines, car les m√™mes versions d'outils tournent partout.

Et parce qu'on aime aller plus loin, nous r√©fl√©chissons d√©j√† √† :

- ajouter des tests automatiques de compatibilit√© lorsqu'une nouvelle version d'asdf sort ;
- publier une image de base sp√©cialis√©e ¬´ IaC Azure ¬ª avec Terraform, Bicep, Packer et Azure Developer CLI d√©j√† pr√©install√©s.

## Partagez vos retours

Nous esp√©rons que cette brique vous fera gagner du temps. Clonez le d√©p√¥t, branchez la feature dans vos projets et dites-nous si tout fonctionne dans vos contextes (mono-repo, projets data, plateformes internes‚Ä¶).

√Ä tr√®s vite pour la suite !
